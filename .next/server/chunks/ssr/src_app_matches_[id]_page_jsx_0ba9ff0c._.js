module.exports=[3394,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(38246),f=a.i(29338),g=a.i(536),h=a.i(21351),i=a.i(6327);a.i(97630);var j=a.i(83915);function k({matchId:a,isJoined:d=!1}){let{user:e}=(0,f.useAuth)(),[h,i]=(0,c.useState)([]),[k,l]=(0,c.useState)(""),[m,n]=(0,c.useState)(!0),[o,p]=(0,c.useState)(!1),[q,r]=(0,c.useState)(null),s=(0,c.useRef)(null);(0,c.useEffect)(()=>(a&&e?(u(),t()):n(!1),()=>{q&&(q.emit("leave_match",a),q.disconnect())}),[a,e]),(0,c.useEffect)(()=>{v()},[h]);let t=()=>{let b=localStorage.getItem("token");if(!b)return;let c=(0,j.io)("http://localhost:5000/api".replace("/api","")||"http://localhost:5000",{auth:{token:b}});c.on("connect",()=>{c.emit("join_match",a)}),c.on("new_message",b=>{(b.match===a||b.matchId===a)&&i(a=>a.some(a=>a._id===b._id)?a:[...a,b])}),r(c)},u=async()=>{try{let b=await (0,g.getMatchMessages)(a);i(b.messages||[])}catch(a){console.error("Failed to fetch messages:",a)}finally{n(!1)}},v=()=>{s.current?.scrollIntoView({behavior:"smooth"})},w=async b=>{if(b.preventDefault(),!k.trim()||o)return;let c=k.trim();l(""),p(!0);try{await (0,g.sendMessage)(a,null,c),i(a=>[...a,{_id:Date.now(),content:c,sender:{_id:e._id,name:e.name},createdAt:new Date().toISOString()}])}catch(a){console.error("Failed to send message:",a),l(c)}finally{p(!1)}};return e?d?(0,b.jsxs)("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl border border-gray-800 flex flex-col h-96",children:[(0,b.jsx)("div",{className:"px-4 py-3 border-b border-gray-800",children:(0,b.jsxs)("h3",{className:"font-bold text-white flex items-center gap-2",children:["ðŸ’¬ Match Chat",(0,b.jsx)("span",{className:"w-2 h-2 bg-green-400 rounded-full animate-pulse"})]})}),(0,b.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[m?(0,b.jsx)("div",{className:"flex justify-center py-8",children:(0,b.jsx)("div",{className:"w-6 h-6 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin"})}):0===h.length?(0,b.jsx)("p",{className:"text-gray-400 text-center py-8",children:"No messages yet. Start the conversation!"}):h.map((a,c)=>{let d=a.sender?._id===e._id;return(0,b.jsx)("div",{className:`flex ${d?"justify-end":"justify-start"}`,children:(0,b.jsxs)("div",{className:`max-w-[80%] ${d?"order-2":""}`,children:[!d&&(0,b.jsx)("p",{className:"text-xs text-gray-400 mb-1",children:a.sender?.name||"Unknown"}),(0,b.jsx)("div",{className:`px-4 py-2 rounded-2xl ${d?"bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-br-sm":"bg-gray-800 text-white rounded-bl-sm"}`,children:(0,b.jsx)("p",{className:"text-sm",children:a.content})}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:new Date(a.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},a._id||c)}),(0,b.jsx)("div",{ref:s})]}),(0,b.jsx)("form",{onSubmit:w,className:"p-3 border-t border-gray-800",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)("input",{type:"text",value:k,onChange:a=>l(a.target.value),placeholder:"Type a message...",maxLength:500,className:"flex-1 px-4 py-2 bg-gray-800 border border-gray-700 rounded-xl text-white text-sm focus:outline-none focus:border-cyan-500"}),(0,b.jsx)("button",{type:"submit",disabled:!k.trim()||o,className:"px-4 py-2 bg-gradient-to-r from-cyan-500 to-purple-500 text-white rounded-xl font-semibold disabled:opacity-50",children:o?"...":"Send"})]})})]}):(0,b.jsxs)("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-white mb-4",children:"Match Chat"}),(0,b.jsx)("p",{className:"text-gray-400 text-center py-8",children:"Join the match to access the chat"})]}):(0,b.jsxs)("div",{className:"bg-gray-900/50 backdrop-blur-xl rounded-xl p-6 border border-gray-800",children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-white mb-4",children:"Match Chat"}),(0,b.jsx)("p",{className:"text-gray-400 text-center py-8",children:"Login to participate in the chat"})]})}function l(){var a;let j,l=(0,d.useParams)(),m=(0,d.useRouter)(),{user:n,isAuthenticated:o}=(0,f.useAuth)(),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)({inGameId:"",inGameName:""}),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)(null),[D,E]=(0,c.useState)(null),[F,G]=(0,c.useState)("");(0,c.useEffect)(()=>{H()},[l.id]),(0,c.useEffect)(()=>{o&&p&&I()},[o,p]);let H=async()=>{try{let a=await g.api.getMatch(l.id);q(a.match)}catch(a){w("Match not found")}finally{s(!1)}},I=async()=>{try{let a=await g.api.getMyMatchStatus(l.id);C(a),(a?.joined||a?.isJoined)&&(a?.roomId?E({roomId:a.roomId,roomPassword:a.roomPassword,scheduledAt:a.scheduledAt}):J())}catch(a){}},J=async()=>{try{let a=await g.api.getRoomCredentials(l.id);E(a)}catch(a){}},K=(a,b)=>{navigator.clipboard.writeText(a),G(b),setTimeout(()=>G(""),2e3)},L=async a=>{if(a.preventDefault(),!o)return void m.push("/login");u(!0),w("");try{await g.api.joinMatch(l.id,x.inGameId,x.inGameName),A(!1),H(),I()}catch(a){w(a.response?.data?.message||a.message||"Failed to join match")}finally{u(!1)}},M=async()=>{if(confirm("Are you sure you want to leave this match?"))try{await g.api.leaveMatch(l.id),H(),C(null)}catch(a){w(a.message)}},N=async()=>{if(confirm("Are you sure you want to cancel this challenge? Your creation fee and prize pool will be refunded to your wallet."))try{let a=await g.api.cancelUserMatch(l.id);alert(`Challenge cancelled! â‚¹${a.refund.total} has been refunded to your wallet.`),m.push("/matches")}catch(a){w(a.message)}};if(r)return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.default,{}),(0,b.jsx)("div",{className:"min-h-screen bg-dark-900 flex items-center justify-center",children:(0,b.jsx)("div",{className:"w-12 h-12 border-4 border-primary-500 border-t-transparent rounded-full animate-spin"})})]});if(v&&!p)return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.default,{}),(0,b.jsx)("div",{className:"min-h-screen bg-dark-900 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-red-400 mb-4",children:v}),(0,b.jsx)(e.default,{href:"/matches",className:"btn-primary",children:"Back to Matches"})]})})]});let O=B?.joined||B?.isJoined,P=p.maxSlots-(p.filledSlots||p.joinedUsers?.length||0)<=0,Q=n&&(p.createdBy?._id===n.id||p.createdBy?._id===n._id||p.createdBy===n.id||p.createdBy===n._id),R=Q&&p.isChallenge&&["upcoming","registration_open"].includes(p.status)&&1>=(p.filledSlots||p.joinedUsers?.length||0);return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.default,{}),(0,b.jsx)("main",{className:"min-h-screen bg-dark-900 py-8",children:(0,b.jsxs)("div",{className:"container mx-auto px-4 max-w-4xl",children:[(0,b.jsxs)(e.default,{href:"/matches",className:"inline-flex items-center text-dark-400 hover:text-white mb-6",children:[(0,b.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Matches"]}),(0,b.jsxs)("div",{className:"card p-6 mb-6 relative",children:[p.isChallenge&&(0,b.jsx)("div",{className:"absolute top-0 right-0 bg-linear-to-r from-gaming-purple to-gaming-orange text-white text-sm font-bold px-4 py-2 rounded-bl-lg rounded-tr-lg",children:"ðŸŽ¯ CHALLENGE MATCH"}),(0,b.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:`inline-block px-3 py-1 rounded-full text-xs font-medium mb-2 ${(a=p.status,(j={upcoming:"bg-blue-500/20 text-blue-400",live:"bg-green-500/20 text-green-400 animate-pulse",completed:"bg-dark-600 text-dark-300",cancelled:"bg-red-500/20 text-red-400"})[a]||j.upcoming)}`,children:p.status.toUpperCase()}),(0,b.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:p.title}),p.isChallenge&&(0,b.jsx)("p",{className:"text-gaming-orange text-sm mt-1",children:"Created by a player â€¢ Winner takes the prize pool!"})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("div",{className:"text-3xl font-bold text-gaming-green",children:["â‚¹",p.prizePool]}),(0,b.jsx)("div",{className:"text-dark-400 text-sm",children:"Prize Pool"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[(0,b.jsxs)("div",{className:"bg-dark-700/50 rounded-lg p-4 text-center",children:[(0,b.jsx)("div",{className:"text-dark-400 text-sm",children:"Entry Fee"}),(0,b.jsx)("div",{className:"text-xl font-bold",children:0===p.entryFee?"FREE":`â‚¹${p.entryFee}`})]}),(0,b.jsxs)("div",{className:"bg-dark-700/50 rounded-lg p-4 text-center",children:[(0,b.jsx)("div",{className:"text-dark-400 text-sm",children:"Mode"}),(0,b.jsx)("div",{className:"text-xl font-bold capitalize",children:p.mode})]}),(0,b.jsxs)("div",{className:"bg-dark-700/50 rounded-lg p-4 text-center",children:[(0,b.jsx)("div",{className:"text-dark-400 text-sm",children:"Slots"}),(0,b.jsxs)("div",{className:"text-xl font-bold",children:[p.filledSlots||p.joinedUsers?.length||0,"/",p.maxSlots]})]}),(0,b.jsxs)("div",{className:"bg-dark-700/50 rounded-lg p-4 text-center",children:[(0,b.jsx)("div",{className:"text-dark-400 text-sm",children:"Map"}),(0,b.jsx)("div",{className:"text-xl font-bold capitalize",children:p.map||"Erangel"})]})]})]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-6 mb-6",children:[(0,b.jsxs)("div",{className:"card p-6",children:[(0,b.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Match Details"}),(0,b.jsxs)("dl",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("dt",{className:"text-dark-400",children:"Game"}),(0,b.jsx)("dd",{className:"font-medium capitalize",children:p.gameType?.replace("_"," ")})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("dt",{className:"text-dark-400",children:"Match Type"}),(0,b.jsx)("dd",{className:"font-medium capitalize",children:p.matchType?.replace("_"," ")})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("dt",{className:"text-dark-400",children:"Scheduled"}),(0,b.jsx)("dd",{className:"font-medium",children:new Date(p.scheduledAt).toLocaleString()})]}),(0,b.jsxs)("div",{className:"flex justify-between",children:[(0,b.jsx)("dt",{className:"text-dark-400",children:"Per Kill"}),(0,b.jsxs)("dd",{className:"font-medium",children:["â‚¹",p.perKillPrize||0]})]})]})]}),(0,b.jsxs)("div",{className:"card p-6",children:[(0,b.jsx)("h2",{className:"text-lg font-bold mb-4",children:"Prize Distribution"}),(0,b.jsx)("div",{className:"space-y-2",children:p.prizeDistribution?.length>0?p.prizeDistribution.map((a,c)=>(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsxs)("span",{className:"text-dark-400",children:[0===c?"ðŸ¥‡":1===c?"ðŸ¥ˆ":2===c?"ðŸ¥‰":`#${c+1}`," ",a.label||`Rank ${a.position||c+1}`]}),(0,b.jsxs)("span",{className:"font-bold text-gaming-green",children:["â‚¹",a.prize??a.amount??0]})]},c)):(0,b.jsx)("p",{className:"text-dark-400",children:"Winner takes all!"})})]})]}),O&&D?.roomId&&(0,b.jsxs)("div",{className:"card p-6 mb-6 border-2 border-gaming-green/50 bg-gradient-to-r from-gaming-green/10 to-transparent",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,b.jsxs)("h2",{className:"text-lg font-bold text-gaming-green flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-2xl",children:"ðŸŽ®"})," Room Credentials"]}),(0,b.jsx)("span",{className:"text-xs bg-gaming-green/20 text-gaming-green px-2 py-1 rounded",children:"READY"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"bg-dark-800 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-dark-400 text-sm mb-1",children:"Room ID"}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-2xl font-mono font-bold tracking-wider",children:D.roomId}),(0,b.jsx)("button",{onClick:()=>K(D.roomId,"roomId"),className:"ml-2 p-2 hover:bg-dark-700 rounded transition-colors",children:"roomId"===F?(0,b.jsx)("span",{className:"text-gaming-green text-sm",children:"âœ“ Copied"}):(0,b.jsx)("svg",{className:"w-5 h-5 text-dark-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]}),(0,b.jsxs)("div",{className:"bg-dark-800 rounded-lg p-4",children:[(0,b.jsx)("div",{className:"text-dark-400 text-sm mb-1",children:"Password"}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-2xl font-mono font-bold tracking-wider",children:D.roomPassword}),(0,b.jsx)("button",{onClick:()=>K(D.roomPassword,"roomPassword"),className:"ml-2 p-2 hover:bg-dark-700 rounded transition-colors",children:"roomPassword"===F?(0,b.jsx)("span",{className:"text-gaming-green text-sm",children:"âœ“ Copied"}):(0,b.jsx)("svg",{className:"w-5 h-5 text-dark-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})})})]})]})]}),(0,b.jsx)("div",{className:"mt-4 text-center text-dark-400 text-sm",children:"Join the room and start the match. Good luck! ðŸ†"})]}),O&&!D?.roomId&&"tdm"===p.matchType&&!P&&(0,b.jsx)("div",{className:"card p-6 mb-6 border border-yellow-500/30 bg-yellow-500/5",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center animate-pulse",children:(0,b.jsx)("span",{className:"text-xl",children:"â³"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold text-yellow-400",children:"Waiting for Opponent"}),(0,b.jsx)("p",{className:"text-dark-400 text-sm",children:"Room credentials will be revealed once an opponent accepts the challenge"})]})]})}),O&&!D?.roomId&&"tdm"!==p.matchType&&"upcoming"===p.status&&(0,b.jsx)("div",{className:"card p-6 mb-6 border border-yellow-500/30 bg-yellow-500/5",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-yellow-500/20 rounded-full flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-xl",children:"â³"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-bold",children:"Waiting for Room Credentials"}),(0,b.jsx)("p",{className:"text-dark-400 text-sm",children:"Room ID and Password will be shared before the match starts"})]})]})}),(0,b.jsxs)("div",{className:"card p-6",children:[v&&(0,b.jsx)("div",{className:"bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 rounded-lg mb-4",children:v}),("upcoming"===p.status||"registration_open"===p.status)&&(0,b.jsx)(b.Fragment,{children:Q?(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gaming-purple/10 border border-gaming-purple/30 rounded-lg",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-bold text-gaming-purple",children:"ðŸ‘‘ You created this challenge"}),(0,b.jsx)("p",{className:"text-dark-400 text-sm",children:"Waiting for an opponent to accept..."})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("div",{className:"text-sm text-dark-400",children:"Invested"}),(0,b.jsxs)("div",{className:"font-bold text-gaming-orange",children:["â‚¹",(p.creationFee||0)+(p.prizePool||0)]})]})]}),R&&(0,b.jsx)("button",{onClick:N,className:"w-full py-3 bg-red-500/10 border border-red-500/30 text-red-400 rounded-lg hover:bg-red-500/20 transition-colors font-medium",children:"ðŸš« Cancel Challenge & Get Refund"}),!R&&p.isChallenge&&(p.filledSlots>1||p.joinedUsers?.length>1)&&(0,b.jsx)("div",{className:"text-center text-yellow-400 text-sm p-3 bg-yellow-500/10 border border-yellow-500/30 rounded-lg",children:"âš ï¸ An opponent has joined. The match cannot be cancelled now."})]}):O?(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-gaming-green font-medium",children:"âœ“ You have joined this match"}),(0,b.jsx)("button",{onClick:M,className:"btn-secondary text-red-400 hover:text-red-300",children:"Leave Match"})]}):(0,b.jsx)("button",{onClick:()=>A(!0),disabled:P,className:"btn-primary w-full py-3 text-lg",children:P?"Match Full":`Join Match - â‚¹${p.entryFee||"FREE"}`})}),"live"===p.status&&(0,b.jsx)("div",{className:"text-center py-4",children:(0,b.jsx)("div",{className:"text-gaming-green text-xl font-bold animate-pulse",children:"Match is LIVE!"})}),"completed"===p.status&&(0,b.jsx)("div",{className:"text-center py-4 text-dark-400",children:"This match has ended"})]}),O&&(0,b.jsx)("div",{className:"mb-6",children:(0,b.jsx)(k,{matchId:l.id,isJoined:O})})]})}),z&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:(0,b.jsxs)("div",{className:"card p-6 w-full max-w-md",children:[(0,b.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Join Match"}),(0,b.jsxs)("form",{onSubmit:L,className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"label",children:"In-Game ID"}),(0,b.jsx)("input",{type:"text",value:x.inGameId,onChange:a=>y({...x,inGameId:a.target.value}),className:"input",placeholder:"Your BGMI ID",required:!0})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"label",children:"In-Game Name"}),(0,b.jsx)("input",{type:"text",value:x.inGameName,onChange:a=>y({...x,inGameName:a.target.value}),className:"input",placeholder:"Your BGMI username",required:!0})]}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:()=>A(!1),className:"btn-secondary flex-1",children:"Cancel"}),(0,b.jsx)("button",{type:"submit",disabled:t,className:"btn-primary flex-1",children:t?"Joining...":"Confirm Join"})]})]})]})}),(0,b.jsx)(i.default,{})]})}a.s(["default",()=>l],3394)}];

//# sourceMappingURL=src_app_matches_%5Bid%5D_page_jsx_0ba9ff0c._.js.map